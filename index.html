<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title> TimerHUB </title>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="images/icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/icons/favicon-32x32.png">

  <!-- iOS -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="PWA Splash">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!--
  <link rel="apple-touch-startup-image" href="images/splash/launch-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="images/splash/launch-750x1294.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="images/splash/launch-1242x2148.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="images/splash/launch-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="images/splash/launch-1536x2048.png" media="(min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="images/splash/launch-1668x2224.png" media="(min-device-width: 834px) and (max-device-width: 834px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="images/splash/launch-2048x2732.png" media="(min-device-width: 1024px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-icon" sizes="180x180" href="images/icons/apple-touch-icon.png">
  -->
  <link rel="mask-icon" href="images/icons/safari-pinned-tab.svg" color="#6F6F6F">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="theme-color" content="#ffffff">
  <title>TH1</title>



  <!--<meta name="apple-mobile-web-app-status-bar" content="#db4938" />-->
  <!--
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="images/logo-pdx.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="white"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="TimerHub">
  <meta name="msapplication-TileImage" content="images/hello-icon-144.png">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  -->

  <!--
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dexie/3.2.4/dexie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/easytimer@1.1.3/src/easytimer.min.js"></script>
  -->

  <!--
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  -->

  <!--
  <link href='https://fonts.googleapis.com/css?family=Roboto Mono' rel='stylesheet'>
  -->


  <!--
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
        crossorigin="anonymous">
  -->


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"/>

  <!--<link rel="stylesheet" href="./css/bootstrap-icons-1.3.0.css">-->
  <!--<link rel="stylesheet" href="./css/bootstrap-icons/bootstrap-icons.css">-->
  <!--
  <link rel="stylesheet" href="./css/Roboto_Mono/font.css">
  <link rel="stylesheet" href="./css/Roboto_Mono/font.css">-->
  <link rel="stylesheet" href="./css/roboto.css">
  <link rel="stylesheet" href="./css/roboto-mono.css">
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/bootstrap-icons-1.5.0/bootstrap-icons-1.5.0.css">
  <!--<link rel="stylesheet" href="./css/main.css">-->
  <link rel="stylesheet" href="./css/pdx.css">
  <link rel="stylesheet" href="./css/style.css">

  <title> TimerHub </title>

</head>

<body class="fullscreen"> <!-- class=@fullscreen> -->

  <!--
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header d-flex w-100">
        <div class="flex-grow-1 align-items-start">
          <a class="navbar-brand" href="#">
            <i class="mt-1 fas fa-bell fa-2x" area-hidden="true"></i>
          </a>
        </div>
        <div class="flex-grow-1 align-items-end">
          <a class="navbar-brand gear" href="#">
            <i class="mt-1 fas fa-bell fa-2x" area-hidden="true"></i>
          </a>
        </div>
      </div>
    </div>
  </nav>
  -->


  <div class="container">

    <!-- --------------------------------- -->
    <!-- Warning message                   -->
    <!-- --------------------------------- -->
    <div id='warning'
         class="alert alert-warning small mt-5 pt-1 pb-1 text-center d-none"
         role="alert">
      This browser doesn't support persistent data storage
    </div>


    <!-- --------------------------------- -->
    <!-- Modal                             -->
    <!-- --------------------------------- -->
    <div class="modal fade" id="staticBackdrop"
         data-bs-backdrop="static" data-bs-keyboard="false"
         tabindex="-1" aria-labelledby="staticBackdropLabel"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body">
            Do you want to reset the timer?
          </div>
          <div class="modal-footer d-flex w-100">
            <div class="flex-grow-1">
              <button type="button" class="btn btn-secondary w-100"
                      data-bs-dismiss="modal">No</button>
            </div>
            <div class="flex-grow-1">
              <button id='rem' type="button" class="btn btn-danger w-100"
                      data-bs-dismiss="modal"> Yes </button>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- ------------------------ -->
    <!-- Offcanvas (RIGHT)        -->
    <!-- ------------------------ -->
    <div class="offcanvas offcanvas-end" tabindex="-1"
         id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
      <div class="offcanvas-header">
        <h5 id="offcanvasRightLabel" class="pdx-title">Settings</h5>
        <button type="button" class="btn-close text-reset"
                data-bs-dismiss="offcanvas" aria-label="Close">
        </button>
      </div>
      <div class="offcanvas-body d-flex flex-column">
        <div>
          <div class="text-start pb-3">
            Select default time for sample preparation and incubation
          </div>

          <div class="text-start pdx-title">
            Sample Preparation
          </div>

          <div id='settings-time-sample-preparation' data-toggle="buttons" disabled>
            <label class="btn  btn-light rounded-5 mb-2">
              <input type="radio" name="settings-sp" id="ssp30" value=30 autocomplete="off" checked> 30s
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-sp" id="ssp60" value=60 autocomplete="off"> 60s
            </label>
          </div>

          <div class="text-start pdx-title pt-3">
            Heat block
          </div>

          <div id='settings-time-heat-block' data-toggle="buttons">
            <label class="btn  btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb3" value=3 autocomplete="off"> 3m
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb15" value=15 autocomplete="off"> 15m
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb20" value=20 autocomplete="off"> 20m
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb25" value=25 autocomplete="off"> 25m
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb30" value=30 autocomplete="off"> 30m
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb35" value=35 autocomplete="off"> 35m
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb40" value=40 autocomplete="off"> 40m
            </label>
            <label class="btn btn-light rounded-5 mb-2">
              <input type="radio" name="settings-hb" id="shb45" value=45 autocomplete="off" checked> 45m
            </label>
          </div>
        </div>

        <div class="flex-grow-1 align-content-end">
          <span class="text-secondary"> Version 0.1.1 </span>
        </div>

        <!--
        <div class="flex-grow-1 align-content-end">
          <button id='reset-db' class="btn btn-danger w-100 rounded-5 bottom-0">Reset</button>
        </div>
        -->

      </div>
    </div>


    <!-- ----------------- -->
    <!-- Navigation bar    -->
    <!-- ----------------- -->
    <div class="row p-2 pt-1">
      <div class="d-flex">

        <div class="flex-grow-1 text-start">
          <a class="icon-faq" href="#">
            <!--<i class="fas fa-bell fa-2x"></i>-->
            <h1><i class="bi bi-question-circle d-inline-block"></i></h1>
            <!--<h1><i class="bi bi-arrow-clockwise d-inline-block"
                    onclick="location.reload()">
            </i></h1>-->
            <!--<h1><i class="bi-question-circle-fill"></i></h1>-->
            <!--<img src="./images/question-circle.svg" class="pdx-icon"/>-->
          </a>

        </div>
        <div class="flex-grow-1 text-end">
          <a class="icon-gear"
              data-bs-toggle="offcanvas"
              href="#offcanvasRight"
              role="button"
              aria-controls="offcanvasRight">
            <!--<i class="fas fa-bell fa-2x"></i>-->
            <h1><i class="bi bi-gear-fill"></i></h1>
            <!--<img src="./images/gear-fill.svg" class="pdx-icon"/>-->
            <!--<h1><i class="bi bi-gear"></i></h1>-->
          </a>
        </div>
      </div>
    </div>


    <!-- ----------------- -->
    <!-- Logo              -->
    <!-- ----------------- -->
    <div class="row mb-5">
      <div class="d-flex justify-content-center">
        <img src="./images/logo-pdx.svg" width="250">
      </div>
    </div>


    <!-- ----------------- -->
    <!-- Hidden            -->
    <!-- ----------------- -->
    <!--<div id="info" class="d-none"></div>-->
    <!--<audio id="bg-audio-prep" src="./audio/mixkit-happy-bells-notification-937.wav"></audio>-->
    <audio id="bg-audio-prep" src="./audio/beep-seconds.mp3"></audio>
    <!--<audio id="bg-audio-warn" src="./audio/mixkit-happy-bells-notification-937.wav"></audio>-->
    <!--<audio id="bg-audio-danger" src="./audio/mixkit-clear-announce-tones-2861.wav"></audio>-->
    <audio id="bg-audio-danger" src="./audio/beep-minutes.mp3"></audio>
    <!--<audio id="bg-audio-past" src="./audio/mixkit-urgent-simple-tone-loop-2976.wav"></audio>-->


    <!-- --------------------------------- -->
    <!-- First Group                       -->
    <!-- --------------------------------- -->
    <!-- Label -->
    <div class="w-100">
      <div class="d-flex justify-content-between w-100 pr-5">
        <div class="p-2 bd-highlight">
          <h3 class="pdx-title mb-0"> Sample Preparation</h3>
        </div>
        <div class="p-2 bd-highlight align-middle">
          <div class="form-check form-switch">
            <label class="form-check-label" for="sample-prep-bell">
              <input id="sample-prep-bell"
                     class="form-check-input"
                     type="checkbox"
                     role="switch"
                     name="bell">
              <i class="bi bi-volume-up-fill"></i>
              <!--<img src="./images/volume-up-fill.svg" class="pdx-icon"/>-->
            </label>
          </div>
        </div>
      </div>
    </div>


    <!-- ----------------- -->
    <!-- Mix/Dry           -->
    <!-- ----------------- -->
    <button id="timer-sample-prep" type="button"
            class="btn btn-idle rounded-5 w-100 mb-2 mt-2">

      <!-- header -->
      <div class="d-flex justify-content-between w-100 pr-5">
        <div class="pdx-timer-id d-none"></div>
        <div class="pdx-timer-label"> Mix/Dry </div>
        <div class="pdx-timer-clock flex-grow-1">
          00:30
        </div>
      </div>

    </button>


    <!-- --------------------------------- -->
    <!-- Heat Block A                      -->
    <!-- --------------------------------- -->
    <div class="w-100 mt-5">
      <div class="d-flex justify-content-between w-100 pr-5">
        <div class="p-2 bd-highlight pdx-title">
          Heat Block 1
        </div>
        <div class="p-2 bd-highlight">
          <div class="form-check form-switch">
            <label class="form-check-label" for="heat-block-bell">
              <input id="heat-block-bell"
                     class="form-check-input"
                     type="checkbox"
                     role="switch"
                     name="bell">
              <i class="bi bi-volume-up-fill"></i>
              <!--<h1><i class="bi bi-volume-off-fill"></i></h1>-->
            </label>
          </div>
        </div>
      </div>
    </div>


    <div id="heat-block-a">

      <!-- ----------------- -->
      <!-- Timer 1           -->
      <!-- ----------------- -->
      <button id="timer-btn-1" data-pdx-id=1 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-1"
              aria-expanded="false" aria-controls="collapse-1">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 1 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-1">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=1
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>

      <!-- ----------------- -->
      <!-- Timer 2           -->
      <!-- ----------------- -->
      <button id="timer-btn-2" data-pdx-id=2 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-2"
              aria-expanded="false" aria-controls="collapse-2">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 2 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-2">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=2
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>


      <!-- ----------------- -->
      <!-- Timer 3           -->
      <!-- ----------------- -->
      <button id="timer-btn-3" data-pdx-id=3 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-3"
              aria-expanded="false" aria-controls="collapse-3">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 3 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-3">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=3
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>


      <!-- ----------------- -->
      <!-- Timer 4           -->
      <!-- ----------------- -->
      <button id="timer-btn-4" data-pdx-id=4 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-4"
              aria-expanded="false" aria-controls="collapse-4">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 4 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-4">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=4
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>
    </div>



    <!-- --------------------------------- -->
    <!-- Heat Block B                      -->
    <!-- --------------------------------- -->
    <div class="w-100 mt-5">
      <div class="d-flex justify-content-between w-100 pr-5">
        <div class="p-2 bd-highlight pdx-title">
          Heat Block 2
        </div>
      </div>
    </div>


    <div id="heat-block-b" style="padding-bottom:50px;">

      <!-- ----------------- -->
      <!-- Timer 5           -->
      <!-- ----------------- -->
      <button id="timer-btn-5" data-pdx-id=5 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-5"
              aria-expanded="false" aria-controls="collapse-5">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 1 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-5">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=5
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>

      <!-- ----------------- -->
      <!-- Timer 6           -->
      <!-- ----------------- -->
      <button id="timer-btn-6" data-pdx-id=6 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-6"
              aria-expanded="false" aria-controls="collapse-6">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 2 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-6">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=6
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>


      <!-- ----------------- -->
      <!-- Timer 7           -->
      <!-- ----------------- -->
      <button id="timer-btn-7" data-pdx-id=7 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-7"
              aria-expanded="false" aria-controls="collapse-7">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 3 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-7">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=7
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>


      <!-- ----------------- -->
      <!-- Timer 4           -->
      <!-- ----------------- -->
      <button id="timer-btn-8" data-pdx-id=8 type="button"
              class="btn btn-idle rounded-5 w-100 mb-2 mt-2" role="alert"
              data-bs-toggle="collapse" data-bs-target="#collapse-8"
              aria-expanded="false" aria-controls="collapse-8">

        <!-- header -->
        <div class="d-flex justify-content-between w-100 pr-5">
          <div class="pdx-timer-id"> 4 </div>
          <div class="pdx-timer-label"> Start </div>
          <div class="pdx-timer-clock flex-grow-1">
          </div>
        </div>

        <!-- content -->
        <div class="collapse w-100" id="collapse-8">
          <div class="pdx-timer-message"></div>
          <div class="d-flex w-100">
            <div class="flex-grow-1 p-1">
              <a class="btn btn-back rounded-5 w-100">Back</a>
            </div>
            <div class="flex-grow-1 p-1">
              <a class="btn btn-removed rounded-5 w-100"
                 data-pdx-id=8
                 data-bs-toggle="modal"
                 data-bs-target="#staticBackdrop">Removed</a>
            </div>
          </div>
        </div>
      </button>

    </div> <!-- Heat Block -->


  </div> <!-- Container -->

  <!-- Load javascript libraries. -->
  <script src="https://unpkg.com/ios-pwa-splash@1.0.0/cdn.min.js"></script>
  <script src="./js/jquery-3.6.0.min.js"></script>
  <script src="./js/bootstrap-5.3.0.min.js"></script>
  <script src="./js/easytimer-1.1.3.min.js"></script>
  <script src="./js/indexeddb.js"></script>
  <script src="./js/pagecycle.js"></script>
  <script src="app.js"></script>

  <!--
  <script src="./js/moment-2.29.1.min.js"></script>
  <script src="./js/dexie-3.2.4.min.js"></script>
  -->
  <script>


    // --------------------------------------------------------
    // Helper methods
    // --------------------------------------------------------
    pad = function(n) {
      return n < 10 ? '0' + n : n;
    };

    String.prototype.format = function () {
      var i = 0, args = arguments;
      return this.replace(/{}/g, function () {
        return typeof args[i] != 'undefined' ? args[i++] : '';
      });
    };


    // --------------------------------------------------------
    // Button style methods
    // --------------------------------------------------------
    function timerReset(obj) {
      /* Reset style */
      obj.removeClass('btn-success')
      obj.removeClass('btn-warning')
      obj.removeClass('btn-danger')
      obj.removeClass('btn-idle')
    }

    function timerSuccess(obj) {
      /* Set timer style */
      if (!obj.hasClass('btn-success')) {
        obj.addClass('btn-success')
        obj.removeClass('btn-warning')
        obj.removeClass('btn-idle')
        obj.removeClass('btn-danger')
        obj.find('.pdx-timer-label').html('Incubating')
        obj.find('.pdx-timer-message').html(
          PROFILE.config.text.messages.incomplete
        )
      }
    }

    function timerWarning(obj) {
      /* Set timer style */
      if (!obj.hasClass('btn-warning')) {
        obj.addClass('btn-warning')
        obj.removeClass('btn-success')
        obj.removeClass('btn-idle')
        obj.removeClass('btn-danger')
        obj.find('.pdx-timer-label').html('Incubating')
        obj.find('.pdx-timer-message').html(
          PROFILE.config.text.messages.incomplete
        )
      }
    }

    function timerDanger(obj) {
      /* Set timer style */
      obj.addClass('btn-danger')
      obj.removeClass('btn-warning')
      obj.removeClass('btn-success')
      obj.removeClass('btn-idle')
      obj.find('.pdx-timer-label').html('Remove')
      obj.find('.pdx-timer-message').html(
        PROFILE.config.text.messages.completed
      )
    }

    function timerPastTime(obj) {
      /* Set timer style */
      obj.removeClass('btn-warning')
      obj.removeClass('btn-success')
      obj.removeClass('btn-idle')
      obj.addClass('btn-danger')
      obj.find('.pdx-timer-label').html('Remove')
      obj.find('.pdx-timer-message').html(
          PROFILE.config.text.messages.pastTime
      )
    }

    function timerIdle(obj) {
      /* Set timer style */
      obj.removeClass('btn-success')
      obj.removeClass('btn-warning')
      obj.removeClass('btn-danger')
      obj.removeClass('counting')
      obj.addClass('btn-idle')
      obj.find('.pdx-timer-clock').html('00:00')
      obj.find('.pdx-timer-label').html('Start')
    }

    // ---------------------------------------------------------
    // Enable functionality
    // ---------------------------------------------------------

     //$('input[name="settings-hb"]').prop('disabled', true)
     //$('input[type="radio"]').prop('disabled', false)
     //function radiobuttonManager(tag, disable) {
     //
     //}


      /*
    // Enable radio button (Not needed!)
    $('#time-heat-block input').on('change', function() {
      var val = $('input[name="settings-hb"]:checked').val();
      console.log(val)
      //PROFILE.config.periods.hb = Number(val) * 60;
      console.log('eh')
      for (const [key, value] of Object.entries(PROFILE.timers)) {
        if (key > 0) {
          value.duration = Number(val) * 60;
        }
      }
      updateProfile(PROFILE)
    });*/

    // Update visual start value on radio button change
    $('#settings-time-sample-preparation input').on('change', function() {
      let val = $('input[name="settings-sp"]:checked').val();
      let str = '00:{}'.format(pad(Number(val)))
      $('#timer-sample-prep').find('.pdx-timer-clock').html(str)
    });

    // Update visual start values on radio button change
    $('#settings-time-heat-block input').on('change', function() {
      // Update visual start value
      updateTimersStartValue()
      // Update settings in db
      let t = $('input[name="settings-hb"]:checked').val();
      PROFILE.config.periods.hb = Number(t)
      updateProfile(PROFILE)

    });

    // Enable functionality for seconds timer
    $('[id^=timer-btn-]').on( "click", function( event ) {
      var id = $(this).attr('data-pdx-id')
      console.log("[{}] Starting timer!".format(id));
      startTimer(id)
    });

    // Disable collapse on first click.
    $('[id^=timer-btn-]').on('show.bs.collapse', function (e) {
      if (!$(this).hasClass('counting')) {
        $(this).addClass('counting')
        e.preventDefault()
      }
    })

    // Disable back click button (handled by bootstrap)
    $('.btn-back').on('click', function (event) {
      event.preventDefault()
      event.stopPropagation()
    })

    // Enable functionality: reset the timer
    $('[id^=timer-btn-]').find('.btn-removed')
      .on('click', function (event) {
        var id = $(this).attr('data-pdx-id');
        console.log("[{}] Stopping timer!".format(id));
        resetTimer(id)
        // Avoid collapse click
        event.preventDefault()
        event.stopPropagation()
      })

    // Silence sample preparation noise.
    $('#sample-prep-bell').on('click', function (e) {
      audioPrep = prepareAudio('bg-audio-prep')
      audioPrep.volume = $(this).is(":checked")
    })


    // Silence heat block noise
    $('#heat-block-bell').on('click', function (e) {
      //audioWarn = prepareAudio('bg-audio-warn')
      audioDanger = prepareAudio('bg-audio-danger')
      //audioPast = prepareAudio('bg-audio-past')
      //audioWarn.volume = $(this).is(":checked")
      audioDanger.volume = $(this).is(":checked")
      //audioPast.volume = $(this).is(":checked")
    })


    // .. note: Do not use!
    $('#reset-db').on('click', function (e) {
      /* It would be great to implement this async, however
         it shows a blocked issue when deleting the database.
         It seems tat close do not get block by delete.
      createDatabase(reset=true).then(function (result) {
        window.location.reload()
      })*/
      createDatabase(reset=true)
      window.location.reload()
    })






    /**
     $('[id^=timer-btn-]').find('.pdx-timer-clock').each(
       function (idx, obj) {
         let t = $('input[name="settings-hb"]:checked').val()
         $(this).html(pad(t) + ':' + pad(0))
     })
    **/


    // Draw numbers on load
    // Draw numbers on settings change
    // Disable settings if timer running


    // ------------------------------------------------
    // Main functions
    // ------------------------------------------------
    function clearAllIntervals() {
      for (var i = 1; i < 99999; i++)
        window.clearInterval(i);
    }

    function isHeatBlockTimerRunning() {
      for ([key, value] of Object.entries(PROFILE.timers)) {
        if ((value.date != null) & (key > 0))
          return true
      }
      return false
    }

    function isSampPrepTimerRunning() {
      return _TIMERS[0].isRunning()
    }

    function disableRadioButtonsHeatBlock(flag) {
      $('input[name="settings-hb"]').prop('disabled', flag)
    }

    function disableRadioButtonsSampPrep(flag) {
      $('input[name="settings-sp"]').prop('disabled', flag)
    }

    function updateTimersStartValue() {
      $('[id^=timer-btn-]').each(function (idx, obj) {
        var id = $(this).attr('data-pdx-id')
        if (PROFILE.timers[id].date == null) {
          let t = $('input[name="settings-hb"]:checked').val()
          $(this).find('.pdx-timer-clock').html(pad(t) + ':' + pad(0))
        }
      })
    }

    function prepareAudio(tag) {
      /* Loads the audio, sets volume to 0, plays it and
         stops it immediately so that it is ready to play
         it later on (hack for iOS). This has to be done
         after a user interaction with the page
       */
      let audio = document.getElementById(tag);
      audio.volume = 0
      audio.play()
      audio.pause()
      return audio;
    }


    function setUpTimerFromDB(id) {
      /**
       *
       *  // if no date
       *    // create empty timer (or do nothing)
       *  // else
       *    // activate counting
       *    // get time from start
       *    // run timer behaviour
       *
       */

      // Load timer from Database
      if (PROFILE.timers[id].date == null) {
        return
      }

      console.log('[' + id + '] setUpTimerFromDB', PROFILE.timers[id])

      // The timer was already counting
      if (!$('#timer-btn-'+id).hasClass('counting'))
        $('#timer-btn-' + id).addClass('counting')

      // Start timer
      PROFILE.timers[id].interval =
        setInterval(function () {
          updateTimer(id)
        }, 500);

      // Disable
      disableRadioButtonsHeatBlock(true)
    }


      /*

      let timer = new Timer();
      timer.start({callback: function (timer) {
        $('#timer-btn-'+ id + ' .pdx-timer-clock').html(
            timer.getTimeValues().toString(['minutes', 'seconds'])
        );
      }});
    }


    function setTimerDate(id, value, updateDB) {
      var duration = $('input[name="settings-hb"]:checked').val()
      PROFILE.timers[id].date = value
      PROFILE.timers[id].duration = Number(duration) * 60;
      if (updateDB)
        updateProfile(PROFILE)
    }


    function getOrCreateTimer(id, reset) {
      if (reset)
        if (_TIMERS[id] != null) {
          _TIMERS[id].stop()
          delete _TIMERS[id]
        }
      if (_TIMERS[id] == null)
        _TIMERS[id] = new Timer()
      return _TIMERS[id]
    }


    function prepend(value, array) {
      var newArray = array.slice();
      newArray.unshift(value);
      return newArray;
    }


    function timeFormat(timer) {
      //if (timer.minutes > 0)
      //    return ['minutes', 'seconds']
      //if (timer.hours > 0)
      //   return ['hours', 'minutes', 'seconds']
      //if (timer.days > 0)
      //    return ['days', 'hours', 'minutes', 'seconds']
      return ['minutes', 'seconds']
    }*/

    function behaviour1(id) {
      /**
       * Counts down until it is done and then keeps the 00:00
       * value. If clicked while counting it does nothing. If
       * clicked while reached 00:00 starts again.
       **/
      // Add timer to variable
      var timer = new Timer()
      _TIMERS[id] = timer
      // Create tag
      //var tag = '#timer-btn-' + id
      var tag = '#timer-sample-prep'

      // Configure click
      $(tag).on( "click", function( event ) {
        $(tag).removeClass('btn-idle')
        $(tag).addClass('btn-success')

        if (!_TIMERS[id].isRunning()) {

          var duration = $('input[name="settings-sp"]:checked').val()

          // Disable settings
          disableRadioButtonsSampPrep(true)

          timer.start({
            countdown: true,
            startValues: { seconds: Number(duration) },
            callback: function (tmr) {
              console.log(tmr)

              $('#timer-sample-prep .pdx-timer-clock').html(
                tmr.toString(['minutes', 'seconds'])
              );
              if (tmr.seconds == 0) {
                $(tag).removeClass('btn-success')
                $(tag).addClass('btn-idle')
                if (audioPrep != null)
                  audioPrep.play()
                // Enable settings
                disableRadioButtonsSampPrep(false)
                // Set value to 60
                $('#timer-sample-prep .pdx-timer-clock').html(
                  '00:'+ pad(parseInt($('input[name="settings-sp"]:checked').val()))
                );
              }
            }
          });
        }
      });
    }




    function setSettingsFromDB() {
      let hb = PROFILE.config.periods.hb
      $('#shb{}'.format(hb)).prop('checked', true)
      updateTimersStartValue()
    }



    // Local variables
    var PROFILE = null
    var _TIMERS = {}
    //var audioWarn = null
    var audioDanger = null
    //var audioPast = null
    var audioPrep = null

    // On document ready
    $(document).ready(function() {

      // Create icon for iOS splash
      iosPWASplash('./images/logo-pdx.png', '#FFFFFF');

      // Should we clear all setInterval just in case?
      clearAllIntervals()

      // Create database if it does not exist
      createDatabase(reset=false).then(function(result) {
        getProfile(1).then( function (result) {
          // Load profile from DB
          PROFILE = result;

          // Set settings from DB.
          setSettingsFromDB()

          // Set all timers to correct start time
          //updateTimersStartValue()

          // Initialise
          behaviour1(0)
          setUpTimerFromDB(1)
          setUpTimerFromDB(2)
          setUpTimerFromDB(3)
          setUpTimerFromDB(4)
          setUpTimerFromDB(5)
          setUpTimerFromDB(6)
          setUpTimerFromDB(7)
          setUpTimerFromDB(8)
        })
      })

    });


    function dhms(t){
      var cd = 24 * 60 * 60 * 1000,
        ch = 60 * 60 * 1000,
        d = Math.floor(t / cd),
        h = Math.floor( (t - d * cd) / ch),
        m = Math.round( (t - d * cd - h * ch) / 60000),
        s = Math.round( )
        pad = function(n){ return n < 10 ? '0' + n : n; };
      if( m === 60 ){
        h++;
        m = 0;
      }
      if( h === 24 ){
        d++;
        h = 0;
      }
      return {
        'days': d,
        'hours': h,
        'minutes': m
      }
      //return [d, pad(h), pad(m)].join(':');
    }


    function dhms2(t) {
      /**
       * Convert timestamp to days, hours, minutes and seconds.
       **/
      var d = Math.floor(t / (1000 * 60 * 60 * 24))
      var h = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
      var m = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60))
      var s = Math.floor((t % (1000 * 60)) / 1000)

      return {
        'days': d,
        'hours': h,
        'minutes': m,
        'seconds': s
      }
   }


    // --------------------------------------------------------
    // Timer
    // --------------------------------------------------------

    function getPDXTime(start, duration) {
      /**
       * date: start date (milliseconds)
       * duration: timer duration (seconds)
       * returns time difference (milliseconds)
       */
      let now = new Date().getTime();
      let elapsed = Math.floor((now - start))
      let countUp = now > start + duration

      if (!countUp) {
        let remaining = duration - elapsed;

        if (remaining <= 0) {
            elapsed = -remaining; // Start counting up from 0
        } else {
            return [remaining, countUp]
        }
      } else
        return [elapsed - (duration - 1 * 1000), countUp]
    }


    function getPDXString(t) {
      pad = function(n) { return n < 10 ? '0' + n : n; };
      if (t.days > 0)
        return '{}:{}:{}:{}'.format(
          t.days, pad(t.hours), pad(t.minutes), pad(t.seconds)
        )
      if (t.hours > 0)
        return '{}:{}:{}'.format(
          pad(t.hours), pad(t.minutes), pad(t.seconds)
        )
      return '{}:{}'.format(
          pad(t.minutes), pad(t.seconds)
      )
    }


    const myAlert = async(message) => {
      return new Promise((resolve) => {
        $('#rem').off()
        $('#rem').on('click', function (event) {
          console.log("User accepted modal, now we can remove!")
          resolve()
        })
      });
    }

    function resetTimer(id) {
      /**
       * Reset timer
       *
       * The method clears the interval task first, then
       * sets all the parameters to null, removes the
       * <counting> class from the interface and sets it
       * to idle.
       *
       **/
      // Reset asynchronous via modal confirmation
      (async function() {
        await myAlert('Hello there');
        window.clearInterval(PROFILE.timers[id].interval)
        PROFILE.timers[id].interval = null;
        PROFILE.timers[id].duration = null;
        PROFILE.timers[id].date = null;
        $('#timer-btn-' + id).removeClass('counting')
        timerIdle($('#timer-btn-'+id))
        // Save in DB.
        updateProfile(PROFILE);
        // Update starting value
        updateTimersStartValue();
        // Enable settings
        if (!isHeatBlockTimerRunning())
          disableRadioButtonsHeatBlock(false)
      })();
    }

    function startTimer(id) {
      /**
       * Start timer
       *
       * The method checks that the timer is not running,
       * and then sets the date, the duration (from settings)
       * and runs the interval periodically (saving id to
       * delete the task afterwards if needed)
       *
       **/
      // Check timer is not running
      if (PROFILE.timers[id].date == null) {
        let p = $('input[name="settings-hb"]:checked').val() // min
        PROFILE.timers[id].date = new Date().getTime()
        PROFILE.timers[id].duration = Number(p) * 60
        PROFILE.timers[id].interval =
          setInterval(function () {
            updateTimer(id)
          }, 500);
        // Save in DB
        updateProfile(PROFILE)
        // Disable settings
        disableRadioButtonsHeatBlock(true)
      }
    }

    function updateTimer(id) {
      /**
       *  Update timer.
       *
       *  The timestamp decreases and when passes 0 then starts
       *  going up again. This is because the TimerPDX has been
       *  designed in that way.
       *
       **/

      // Get html object
      var obj = $('#timer-btn-' + id)

      // Get days, hours, minutes, seconds
      var start = PROFILE.timers[id].date
      var period = PROFILE.timers[id].duration
      var [timestamp, countUp] = getPDXTime(start, period * 1000)
      var time = dhms2(timestamp)
      var display = getPDXString(time)
      //console.log(time)
      //console.log("[{}] UpdateTimer: {} {} {} {} {} {}".format(
      //  id, start, period, timestamp, countUp, display))

      if (countUp)
        display = '+' + display

      // Update time displayed
      obj.find('.pdx-timer-clock').html(display)

       // Ensure there is no idle if running
      if (obj.hasClass('btn-idle'))
        obj.removeClass('btn-idle')

      if (!countUp) {
        if (timestamp > 5 * 60 * 1000) { // 5 min
          timerSuccess(obj)
        } else if (timestamp > 0) {
          timerWarning(obj)
        } else {
          console.log("[updateTimer] What state is this?")
        }
      } else {
        if (timestamp < 1500) { // or use day, hour, min, sec all 0
          if (audioDanger != null)
            audioDanger.play()
        }
        if (timestamp < 5 * 60 * 1000) { // 5 min
          timerDanger(obj)
        } else {
          timerPastTime(obj)
        }
      }
    }

    /**
     * Quick timer test
     */
    var ds = new Date().getTime()
    var duration = 30 * 1000

    // Set date on console.
    //PROFILE.timers[id].date = new Date().getTime()

    // Run interval
    /*
    setInterval(function() {
      let id = 1;
      updateTimer(id)
    }, 1000);
    */


  </script>

</body>
</html>
